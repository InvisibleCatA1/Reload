package com.invisiblecat.reload.module.modules.exploit;

import com.invisiblecat.reload.Reload;
import com.invisiblecat.reload.event.EventTarget;
import com.invisiblecat.reload.event.events.EventJoinWorld;
import com.invisiblecat.reload.event.events.EventRecivePacket;
import com.invisiblecat.reload.event.events.EventSendPacket;
import com.invisiblecat.reload.event.events.EventUpdate;
import com.invisiblecat.reload.module.Category;
import com.invisiblecat.reload.module.Module;
import com.invisiblecat.reload.setting.settings.ModeSetting;
import com.invisiblecat.reload.setting.settings.NumberSetting;
import com.invisiblecat.reload.utils.NumberUtils;
import com.invisiblecat.reload.utils.PacketUtils;
import com.invisiblecat.reload.utils.TimerUtils;
import com.mojang.realmsclient.gui.ChatFormatting;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.*;
import net.minecraft.network.play.server.S2EPacketCloseWindow;
import net.minecraft.network.play.server.S31PacketWindowProperty;

public class Disabler extends Module {

    private final TimerUtils lagDelay = new TimerUtils();
    private final TimerUtils delay1 = new TimerUtils();

    private int count = 0;

    private final ModeSetting mode = new ModeSetting("Mode", "Blocks MC", "Blocks MC", "Mineplex Combat", "Blocks MC Movement");


    public Disabler() {
        super("Disabler", 0, Category.EXPLOIT, AutoDisable.NONE);
        this.addSettings(mode);
    }

    @EventTarget
    public void onUpdate(EventUpdate event) {
        this.setDisplayName("Disabler " + ChatFormatting.GRAY + mode.getSelected());
    }

    @EventTarget
    public void onPacket(EventSendPacket event) {
        Packet packet = event.getPacket();

        switch (mode.getSelected().toLowerCase().replaceAll("\\s", "")) {
            case "blocksmccombat":
                if (packet instanceof C0FPacketConfirmTransaction) {
                    if (mc.thePlayer.isDead) {
                        count = 0;
                    }
                    if (count != 0) event.setCancelled(true);
                    count++;
                } else if (packet instanceof C0BPacketEntityAction) {
                    event.setCancelled(true);
                } else if (packet instanceof C00PacketKeepAlive) {
                    ((C00PacketKeepAlive) packet).setKey(((C00PacketKeepAlive) packet).getKey() - ((C00PacketKeepAlive) packet).getKey() / 2);

                }
            case "blocksmc":
                if(packet instanceof C0BPacketEntityAction) {
                    event.setCancelled(true);
                }
                if(packet instanceof C03PacketPlayer) {
                    mc.getNetHandler().addToSendQueue(new C0CPacketInput(0,0, false, false));
                }
                if(packet instanceof C0CPacketInput) {
                    final C0CPacketInput C0Cpacket = (C0CPacketInput) event.getPacket();

                    C0Cpacket.setForwardSpeed(0);
                    C0Cpacket.setStrafeSpeed(0);

                    C0Cpacket.setSneaking(mc.thePlayer.getAge() % 2 != 0);
                    C0Cpacket.setJumping(mc.thePlayer.getAge() % 2 == 0);


                }
        }

    }

    @EventTarget
    public void onJoinWorld(EventJoinWorld event) {
        switch (mode.getSelected().toLowerCase().replaceAll("\\s", "")) {
            case "blocksmccombat":
                count = 0;
        }
    }
}
